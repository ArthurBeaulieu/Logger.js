

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: Logger.js | Logger.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">

    
</head>
<body>
<nav class="lnb" id="lnb">
    <div class="logo" style="">
        
            <img src="img/toast-ui.png" width="100%" height="100%">
        
    </div>
    <div class="title">
        <h1><a href="index.html" class="link">Logger.js</a></h1>
        
            <span class="version">v1.0.0</span>
        
    </div>
    <div class="search-container" id="search-container">
        <input type="text" placeholder="Search">
        <ul></ul>
    </div>
    
    <div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="Logger.html">Logger</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Logger_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Logger.html#_errors">_errors</a></li><li><a href="Logger.html#_log">_log</a></li><li><a href="Logger.html#_notification">_notification</a></li><li><a href="Logger.html#version">version</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Logger.html#._buildErrorInfo">_buildErrorInfo</a></li><li><a href="Logger.html#._getCallerName">_getCallerName</a></li><li><a href="Logger.html#._logErrorToConsole">_logErrorToConsole</a></li><li><a href="Logger.html#._logErrorToNotification">_logErrorToNotification</a></li><li><a href="Logger.html#.destroy">destroy</a></li><li><a href="Logger.html#.raise">raise</a></li></ul></div></li></ul></div>
</nav>
<div id="resizer"></div>

<div class="main" id="main">
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';


class Logger {


  /** @summary &lt;h1>JavaScript logger singleton to handle errors the same way&lt;/h1>
   * @author Arthur Beaulieu
   * @since June 2020
   * @description &lt;blockquote>The Logger class provides a singleton object to allow brain dead logging for frontend
   * JavaScript code. Errors can be raised from JavaScript errors (&lt;code>new Error()&lt;/code>), or using a custom error
   * format, with a severity, title and message. It is also possible to pass a notification manager object to handle
   * those error either in console and in UI. The recommended manager to use for notification can be found at
   * &lt;a href="https://github.com/ArthurBeaulieu/Notification.js" alt="notification-js">Notification.js&lt;/a>. You can
   * otherwise implement you system, but it as to take a type (severity), a title and a message ; for further information,
   * refer to the &lt;code>_logErrorToNotification&lt;/code> documentation. For source code, please go to
   * &lt;a href="https://github.com/ArthurBeaulieu/Logger.js" alt="logger-js">Logger.js&lt;/a>&lt;/blockquote>
   * @param {object} [options={}] - The Logger object, not mandatory but it is recommended to provide one for full features
   * @param {object} [options.errors={}] - The custom errors, JSON style, with key being the error name and value being
   * an object with a &lt;code>severity&lt;/code>, a &lt;code>title&lt;/code> and a &lt;code>message&lt;/code> property (all strings)
   * @param {object} [options.notification=null] - The notification manager (to create new notifications when logging)
   * @param {boolean} [options.log=true] - Allow console logging (turn to false in prod environment)
   * @return {object} - The Logger singleton instance */
  constructor(options = {}) {
    // If an instance of Logger already exists, we just return it
    if (!!Logger.instance) {
      return Logger.instance;
    }
    // Set object instance
    Logger.instance = this;
    // Prevent wrong type for arguments
    if (typeof options.errors !== 'object') { options.errors = {}; }
    if (typeof options.notification !== 'object') { options.notification = null; }
    if (typeof options.log !== 'boolean') { options.log = true; }
    /** @private
     * @member {object} - The error messages to use in Logger */
    this._errors = options.errors;
    /** @private
     * @member {object} - The custom notification handler, must be able to take type, title and message (at least) */
    this._notification = options.notification;    
    /** @private
     * @member {boolean} - Internal logging flag from constructor options, allow to output each event action */
    this._log = options.log;
    /** @public
     * @member {string} - Component version */
    this.version = '1.0.0';
    return this;
  }


  /** @method
   * @name destroy
   * @public
   * @memberof Logger
   * @description &lt;blockquote>Logger destructor. Will delete singleton instance and its properties.&lt;/blockquote> */
  destroy() {
    // Delete object attributes
    Object.keys(this).forEach(key => { delete this[key]; });
    Logger.instance = null;
  }


  /*  --------------------------------------------------------------------------------------------------------------- */
  /*  ----------------------------------------  LOGGER JS INTERN METHODS  ------------------------------------------  */
  /*                                                                                                                  */
  /*  These internal methods will build a raised error depending on logging level sent when building this singleton.  */
  /*  --------------------------------------------------------------------------------------------------------------- */


  /** @method
   * @name _buildErrorInfo
   * @private
   * @memberof Logger
   * @description &lt;blockquote>This method will be the error properties according to its type. A custom error will
   * take values defined at construction of this singleton. JavaScrip error are parsed to extract title and
   * message properties from stack, with specific handling for Chrome and Firefox.&lt;/blockquote>
   * @param {object} error - The error to build info from. Can be a custom error or a standard JavaScript error
   * @return {object} - The error properties ; &lt;code>severity&lt;/code>, &lt;code>title&lt;/code> and &lt;code>message&lt;/code> */
  _buildErrorInfo(error) {
    let severity = '';
    let title = '';
    let message = '';
    if (typeof error === 'object' || typeof error === 'string') {
      // this._errors doesn't contain the error key ; either a Js error or an unknown error
      if (this._errors[error] === undefined) {
        // JavaScript error created with new Error(), that need to contain fileName, message, line and column number
        let filename = '';
        if (error.fileName &amp;&amp; error.message &amp;&amp; error.lineNumber &amp;&amp; error.columnNumber) { // Firefox specific
          filename = error.fileName.match(/\/([^\/]+)\/?$/)[1];
          severity = 'error';
          title = `JavaScript error`;
          message = `${error.message} in file ${filename}:${error.lineNumber}:${error.columnNumber}`;
        } else if (error.message &amp;&amp; error.stack) { // Chrome specific
          filename = error.stack.split('\n')[error.stack.split('\n').length - 1].match(/\/([^\/]+)\/?$/)[1];
          severity = 'error';
          title = `JavaScript error`;
          message = `${error.message} in file ${filename}`;
        } else { // Unknown error that do not require any arguments
          severity = 'error';
          title = `Unexpected error ${error}`;
          message = 'The error object sent to Logger.raise() is neither a JavaScript error nor a custom error (with severity, title and message).';
        }
      } else { // Custom error that need to be filled with a severity, a title and a message
        severity = this._errors[error].severity || '';
        title = this._errors[error].title || '';
        message = this._errors[error].message || '';
      }
    }
    // Return error standard properties
    return {
      severity: severity,
      title: title,
      message: message
    };
  }


  /** @method
   * @name _logErrorToNotification
   * @private
   * @memberof Logger
   * @description &lt;blockquote>This method will call for a new notification if a component has been given to this singleton
   * constructor. The component must expose a &lt;code>new()&lt;/code> methods that takes as arguments the Logger standard properties ;
   * &lt;code>severity&lt;/code>, &lt;code>title&lt;/code> and &lt;code>message&lt;/code>. If no component has be provided, this method won't do anything.
   * One can find such component &lt;a href="https://github.com/ArthurBeaulieu/Notification.js" alt="notification-js">here&lt;/a>.&lt;/blockquote>
   * @param {object} errorParameters - The error with Logger standard properties (&lt;code>severity&lt;/code>, &lt;code>title&lt;/code> and &lt;code>message&lt;/code>) */
  _logErrorToNotification(errorParameters) {
    if (this._notification &amp;&amp; typeof errorParameters === 'object') {
      this._notification.new({
        type: errorParameters.severity || 'error',
        title: errorParameters.title || 'Can\'t get error info',
        message: errorParameters.message || 'Call for new notification wasn\'t made with arguments'
      });
    }
  }


  /** @method
   * @name _logErrorToConsole
   * @private
   * @memberof Logger
   * @description &lt;blockquote>This method will send error to console if logging has been allowed to this singleton constructor.
   * It takes a Logger standard error (&lt;code>severity&lt;/code>, &lt;code>title&lt;/code> and &lt;code>message&lt;/code>) as argument.
   * It will build a unified output regardless the Chrome or Firefox browser. It enhance &lt;code>console.log&lt;/code> and
   * &lt;code>console.info&lt;/code> to also display the stack trace in a &lt;code>console.group&lt;/code>.&lt;/blockquote>
   * @param {object} errorParameters - The error with Logger standard properties (&lt;code>severity&lt;/code>, &lt;code>title&lt;/code> and &lt;code>message&lt;/code>) */
  _logErrorToConsole(errorParameters) {
    if (this._log &amp;&amp; typeof errorParameters === 'object') {
      // Missing mandatory arguments
      if (!errorParameters.severity &amp;&amp; !errorParameters.title &amp;&amp; !errorParameters.message) {
        return;
      }
      /* Colors to use, extracted from Notification.js (https://github.com/ArthurBeaulieu/Notification.js) */
      const colors = {
        success: 'color: rgb(76, 175, 80);',
        info: 'color: rgb(3, 169, 244);',
        warning: 'color: rgb(255, 152, 0);',
        error: 'color: rgb(244, 67, 54);'
      };    
      const browsers = {
        firefox: /firefox/i.test(navigator.userAgent),
        chrome: /chrome/i.test(navigator.userAgent) &amp;&amp; /google inc/i.test(navigator.vendor)
      };
      // Compute log level from severity, and handle warn and log as warning and success
      let logLevel = errorParameters.severity;
      if (errorParameters.severity === 'warning') { 
        logLevel = 'warn';
      } else if (errorParameters.severity === 'success') { 
        logLevel = 'log';
      }
      // Create console group with associated style
      console.groupCollapsed(`%c${errorParameters.severity.toUpperCase()}: ${errorParameters.title}`, colors[errorParameters.severity]);
      // Apply type and severity to build console call
      const outputString = `%c${errorParameters.message}\n${this._getCallerName(browsers)}`;
      console[logLevel](outputString, colors[errorParameters.severity]);
      // Only append console trace if severity is not an error (as error already display trace)
      if (errorParameters.severity !== 'error' &amp;&amp; errorParameters.severity !== 'warning') { console.trace(); }
      console.groupEnd();
    }
  }


  /** @method
   * @name _getCallerName
   * @private
   * @memberof Logger
   * @description &lt;blockquote>This method will build the caller name as a string, formatted to be easy to
   * read and display in the log output.&lt;/blockquote>
   * @param {object} browsers - An object with booleans values for current browser used by session
   * @return {string} - The Logger standard caller name regardless the browser */
  _getCallerName(browsers) {
    // Original code from: https://gist.github.com/irisli/716b6dacd3f151ce2b7e
    let caller = (new Error()).stack; // Create error and get its call stack
    // Get last called depending on browser
    if (typeof browsers === 'object') {
      if (browsers.firefox) {
        caller = caller.split('\n')[3];
        caller = caller.replace(/@+/, ' '); // Change `@` to `(`
      } else if (browsers.chrome) {
        caller = caller.split('\n')[caller.split('\n').length - 2];
        // Remove Chrome specific strings to match Firefox look and feel (go ff)
        caller = caller.replace(/^Error\s+/, '');
        caller = caller.replace(/^\s+at./, '');
        caller = caller.replace(/[{()}]/g, '');
      } else {
        return 'Unsupported browser to get the caller name from';
      }
    } else {
      return 'Argument error, unable to get the caller name on this raise';
    }

    return `Raised from function ${caller.charAt(0) === ' ' ? `&lt;anonymous>${caller}`: caller}`;
  }


  /*  --------------------------------------------------------------------------------------------------------------- */
  /*  ----------------------------------------  LOGGER JS PUBLIC METHOD  -------------------------------------------  */
  /*                                                                                                                  */
  /*  These are the exposed method of Logger component. It allows to raise error that will be displayed in the        */
  /*  console if needed, and displayed in the interface using a notification component. Otherwise, it won't do        */
  /*  anything.                                                                                                       */
  /*  --------------------------------------------------------------------------------------------------------------- */


  /** @method
   * @name raise
   * @public
   * @memberof Logger
   * @description &lt;blockquote>The raise method will build, according to argument sent to this singleton constructor,
   * a console output and/or a notification for the given error. The input error can be a standard JavaScript error,
   * raised like &lt;code>new Error()&lt;/code>, but can also be build using the custom format, using the key of the error
   * as input string. See constructor and example for demonstration.&lt;/blockquote>
   * @param {object} error - The error to handle. Can be a custom error or a standard JavaScript error */
  raise(error) {  
    // Create error specific values depending on error origin (JavaScript, Custom or Unknown) */    
    const errorParameters = this._buildErrorInfo(error);
    /* If any Notification manager exists, use it with error parameters */
    this._logErrorToNotification(errorParameters)
    /* In debug mode, fill the console with error parameters */
    this._logErrorToConsole(errorParameters);
  }


}


export default Logger;
</code></pre>
        </article>
    </section>




</div>

<footer>
    <img class="logo" src="img/toast-ui.png" style="">
    <div class="footer-text">Logger.js</div>
</footer>
<script>prettyPrint();</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/tui-doc.js"></script>
<script src="scripts/linenumber.js"></script>

    <script>
        var id = '_sub'.replace(/"/g, '_');
        var selectedApi = document.getElementById(id); // do not use jquery selector
        var $selectedApi = $(selectedApi);

        $selectedApi.removeClass('hidden');
        $selectedApi.parent().find('.glyphicon').removeClass('glyphicon-plus').addClass('glyphicon-minus');
        showLnbApi();
    </script>

</body>
</html>
